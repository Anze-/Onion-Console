<link rel="import" href="/lib/polymer/polymer.html">
<link rel="import" href="/lib/iron-signals/iron-signals.html">
<link rel="import" href="/elements/bootstrap-styles/bootstrap-shared-styles.html">
<link rel="import" href="/elements/bootstrap-alert/bootstrap-alert.html">
<link rel="import" href="/lib/iron-flex-layout/classes/iron-flex-layout.html">

<dom-module id="onion-login">
	<style>
		:host {
			height: 100%;
			width: 100%;
		}

		#login-container {
			height: 100%;
			width: 100%;
		}

		#login-box {
			width: 320px;
			background-color: #fff;
		}
	</style>

	<template>
		<div id="login-container" class="layout horizontal center-justified center">
			<div class="card" id="login-box">
				<div class="card-header">
					Login
				</div>
				<div class="card-block">
					<form on-submit="login">
						<fieldset class="form-group">
							<label for="username">Username</label>
							<input type="text" class="form-control" id="username">
						</fieldset>
						<fieldset class="form-group">
							<label for="password">Password</label>
							<input type="password" class="form-control" id="password">
						</fieldset>
						<div id="messageContainer"></div> 
						
						<button type="submit" class="btn btn-success">Login</button>
					</form>
				</div>
			</div>
		</div>
	</template>

	<script>
		'use strict';

		(function () {
			var onionLogin = null;

			var ready = function () {
				onionLogin = this;
				onionConsole.getService('onion-session-provider', function (session) {
	            	onionLogin.session = session;
	            });
			};

			var login = function (e) {
				e.preventDefault();

				// var username = document.querySelector('#username').value;
				var username = this.$.username.value;
				var password = document.querySelector('#password').value;

				this.session.login(username, password, function (result) {
					if (result.success) {
						onionConsole.launchApp('onion-launcher');
					} else {
						var alertElement = document.createElement('bootstrap-alert');
						alertElement.setAttribute('warning', true);
						alertElement.setAttribute('message', 'Login failed.');

						Polymer.dom(onionLogin.$.messageContainer).appendChild(alertElement);
					}

				});
			};
			
			Polymer({
				is: 'onion-login',
				ready: ready,
	            login: login
			});
        })();
	</script>
</dom-module>
