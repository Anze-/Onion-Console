<link rel="import" href="/lib/polymer/polymer.html">
<link rel="import" href="/lib/iron-signals/iron-signals.html">
<link rel="import" href="/lib/iron-flex-layout/classes/iron-flex-layout.html">
<link rel="import" href="/services/onion-ubuspackages-provider.html">

<dom-module id="onion-login">
	<style>
		:host {
			height: 100%;
			width: 100%;
		}

		#login-box {
			width: 320px;
			border-color: transparent;
		}

		#login-container {
			height: 100%;
			width: 100%;
		}
	</style>

	<template>
		<div id="login-container" class="layout horizontal center-justified center">
			<div id="login-box" class="panel panel-default">
				<div class="panel-heading">
					<h3 class="panel-title">Login</h3>
				</div>
				<div class="panel-body">
					<div class="form-group">
						<label for="username">Username</label>
						<input type="text" id="username" label="Username"></input>
					</div>
					<div class="form-group">
						<label for="password">Password</label>
						<input id="password" label="Password" type="password"></input>
					</div>
					<div id="msg">{{loginMsg}}</div> 
					<div class="form-group">
						<button on-click="login" class="btn btn-success">Login</button>
					</div>
				</div>
			</div>
		</div>
	</template>

	<script>
		var onionLogin = null;

		var ready = function () {
			onionLogin = this;
			onionConsole.getService('onion-session-provider', function(session){
            	onionLogin.session = session;
            	console.log('session updated')
            })

            this.loginMsg = "";
			
		};

		var login = function () {
			var username = document.querySelector('#username').value;
			var password = document.querySelector('#password').value;

			this.session.login(username, password, function(result){
				if (result.success){
					onionLogin.loginMsg = "";
					onionConsole.launchApp("onion-launcher");
				}else {

					onionLogin.loginMsg = "Login Failed!"

				}

			});
		};
		
		Polymer({
			is: 'onion-login',
			ready: ready,
            login: login
		});
	</script>
</dom-module>
