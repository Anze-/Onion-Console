<link rel="import" href="/lib/polymer/polymer.html">
import shared service

<dom-model id="onion-apps-provider">
	<script>
        'use strict';

        (function () {
            // var self = null;

            var created = function () {
                // self = this;
            };

            var apps = [];

            var ready = function () {
                onionConsole.getService('onion-ubus-provider', function (err, ubus) {
                    console.log("Inside the ready callback this =",this);
                    this.ubus = ubus;
                    this.reload();
                }.bind(this));
                console.log("Inside ready",this);
				// this.getApps(function(){});
            };

            var  getApps = function(callback) {

                this.ubus.request('onion-console', 'app-list', {}, function (result) {
                    if (result.length === 2 && result[1].exists) {
						// this.currentApps = result[1].apps;
                        callback(null, result[1].apps);
                    }else{
                        callback("ubus service error", null);
                    }
                }.bind(this));
            }

            var reload = function () {
                console.log("Inside reload",this.ubus);
                this.ubus.request('onion-console', 'app-list', {}, function (result) {
                    if (result.length === 2 && result[1].exists) {
                        this.apps = [];                     
                        for (var i = 0; i < result[1].apps.length; i++) {
                            this.apps.push(result[1].apps[i]);
                        }
                    }
                }.bind(this));
            };
			
			// // pass in id of an app, get the whole object back
			// var getApp = function (appId) {
			// 	// check currentApps for app with id == appId
			// 	var targetApp = this.currentApps.find(function (app) {
			// 		return appId === app.id;
			// 	});
			// 	if (targetApp) {
			// 		return targetApp;
			// 	} else {
			// 		return null;
			// 	}
			// };

            Polymer({
                is: 'onion-apps-provider',
                created: created,
                apps: apps,
                ready: ready,
                reload: reload,
                getApps: getApps,
				// getApp:getApp,
				// properties: {
				// 	currentApps: {
				// 		type: Array,
				// 		value: [],
				// 		notify: true
				// 	}
				// }
            });
        })();
	</script>
</dom-model>
