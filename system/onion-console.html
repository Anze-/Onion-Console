<link rel="import" href="/lib/polymer/polymer.html">
<link rel="import" href="/lib/iron-flex-layout/classes/iron-flex-layout.html">
<link rel="import" href="/lib/iron-pages/iron-pages.html">

<link rel="import" href="./onion-launcher.html">
<link rel="import" href="/apps/onion-app-template/onion-app-template.html">
<link rel="import" href="./services/onion-apps-provider.html">

<dom-module id="onion-console">
	<style>
		:host {
		}

		#appContainer {
			background-color: rgba(255,255,255,0.8);
		}

		.console {
			height: 100%;
		}

	</style>

	<template>
		<iron-pages selected="0">
			<onion-app-template></onion-app-template>
			<onion-launcher id="launcher" apps="{{apps}}"></onion-launcher>
		</iron-pages>
	</template>

	<script>
		'use strict';


		var ready = function () {
			this.runningApps = {};
			this.currentApp = {};

			this.apps = document.createElement('onion-apps-provider').getApps();



			// this.$.launcher.apps = this.apps;

			





			// this.deviceInfo = this.$.deviceinfo.getInfo();
		// 	this.appContainer = this.$.appContainer;
		// 	this.deviceId = '0506D6';
		// 	this.deviceName = 'Onion Omega ' + this.deviceId;

		// 	// Set up event listener to child apps
		// 	this.addEventListener('launchApp', function(e){
		// 		this.launchApp(e.detail);
		// 	});

		// 	this.launchApp({appId: 'onion-launcher'});
		};


		var testListener = function(e){
			// this.launchApp(e.detail);
			console.log(e.detail);
		};

		var launchApp = function (app) {
			var	appId = app.appId;

			if (this.appContainer.querySelector(appId)) {
				this.currentApp = appId;
			} else {
				var self = this;

				Polymer.import(['/elements/apps/' + appId + '/' + appId + '.html'], function () {
					var appElement = document.createElement(appId);
					appElement.setAttribute('id', appId);
					appElement.setAttribute('deviceId', self.deviceId);
					appElement.setAttribute('deviceName', self.deviceName);
					self.appContainer.appendChild(appElement);

					self.currentApp = appId;
				});
			}
		};

		Polymer({
			is: "onion-console",
			ready: ready,
			// launchApp: launchApp,

			testListener: testListener,

			listeners:{
				'launchApp': 'testListener'
			}
		});

	</script>

</dom-module>
